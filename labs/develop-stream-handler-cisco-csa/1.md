# <center>Develop a Stream Handler for Cisco CSA</center>

<b>Introduction about Cisco® Connected Streaming Analytics (CSA) </b><br>

Cisco® Connected Streaming Analytics (CSA) is an analytics platform that delivers predictive, actionable insights from high-velocity streams of live data.

* Streaming query processing supports active, continuous monitoring of live data. This provides instantaneous, real-time analysis and action, as well as efficient use of compute resources. 
* CSA’s framework and interfaces are ideal for use case development across a wide variety of business and network management functions and industries. 
* CSA provides real-time insights with big data views to support actionable events and dynamic dashboards to help you get more value out of your data. 

<font color='red'>Request access to the Data Learning Platform by sending a message to:</font> [datalearningplatform@cisco.com](mailto:datalearningplatform@cisco.com)

## Lab Overview

In this Learning Lab, you will learn how to develop CSA custom handlers for using CSA in our DLP platform.<br>
Our platform has Kafka messaging framework working from backend. This utility will take the IP, Port and the Topic details of Kafka messaging system. The application will listen to a local socket continuously and will push the stream from this socket to the Kafka. Our sample Java code for handling the log data stream. This java file need to mention in the XML configuration file.

![Figure](https://github.com/prakdutt/data-dev-learning-labs/blob/master/labs/develop-stream-handler-cisco-csa/assets/images/csa.jpg?raw=true)

## Lab Objective

* Building custom handler for CSA in DLP and analyze the data at real time. 

## Prerequisites

* knowledge on Java 1.6 or above.
* knowledge on SQL query.
* knowledge using GitHub.
* Basic knowledge on XML.
* Chrome Browser.


### Now we are going to demo for a web server log Analysis step by step.

In this Web Server Log Analysis demo, we are going to use a Log Simulator, CSA Engine and the customized handler. First we need to create the environment. For creating environment, we need to start the Log simulator and CSA engine. This can be done through the configuration file which will build the handler.
Basically the full process we can split in 3 major sections.

</br>
* Section A: Setup The CSA Engine and Log Simulator.
* Section B: Codeing and configure the customized CSA Handler.
* Section C: The Visualization section with Zeppelin.

### Section A: Setup The CSA Engine and Log Simulator

<b>Step 1:</b> Explore Data Learning Platform(DLP)

<font color='red'>Request access to the Data Learning Platform by sending a message to:</font> [datalearningplatform@cisco.com](mailto:datalearningplatform@cisco.com)

<b>Step 2:</b> From DLP platform, open <b>App Stack Hub</b> option and click on <b>Create Stack</b> button from top-right corner.

![Figure](https://github.com/CiscoDevNet/data-dev-learning-labs/blob/master/labs/develop-stream-handler-cisco-csa/assets/images/AppStackStoreSelection.PNG?raw=true)

<b>Step 3:</b>Clicking on <b>Create Stack</b> button, below screen will open. Fillup all the details as given below.
```
Stack Name : Always should be Unique.
Rack host  : Select the rack from which rack will Host.
```
Now click on the submit button to create the stack.

![Figure](https://github.com/prakdutt/data-dev-learning-labs/blob/master/labs/develop-stream-handler-cisco-csa/assets/images/step7.jpg?raw=true)


<b>Step 4:</b> After creating the stack, drag and drop the below components from source library.<br> 
    1) Log simulator </br>
    2) TruCQ </br>
 <b>We need to build a connection between LogSimulator and TruCQ micro-services using drag and drop fecility. User can drag the LogSimulator and TruCQ component from DataSource List and drop in the Stack Designer area. Now the connection can be made between these two by selecting the red circled on TruCQ. It will open a dialog box where user need to input the details as described in below image.</b>
![Figure](https://github.com/prakdutt/data-dev-learning-labs/blob/master/labs/develop-stream-handler-cisco-csa/assets/images/stackConfig.PNG?raw=true)


<b>N.B</b> If you can't find <b>LogSimulator</b>, <b>TrueCQ</b> under <b>DataSource List</b> it means that the services are not available. In this case, please click on the <b>Micro Service Hub</b> and then click on <b>DevNet Docker</b> tab. Select truecq and select "Add to My Service List". Please follow the below screen shot.
</br><b>Micrservice Hub->DevNet Docker</b> </br>
![Figure](https://github.com/CiscoDevNet/data-dev-learning-labs/blob/master/labs/develop-stream-handler-cisco-csa/assets/images/SelectmicroService.png?raw=true) </br>
<b>Follow same process for selection of Logsimulator</b>


<b>Step 5:</b> For Configuration of the Microservices,Please select a single Microservice and click on the <b>Config</b> button.

![Figure](https://github.com/CiscoDevNet/data-dev-learning-labs/blob/master/labs/develop-stream-handler-cisco-csa/assets/images/CSA_5.png?raw=true) 


Now configure the Kafka topic in log simulator and Trucq for CSA.<br>

#### (i) Log Simulator we need to configure Kafka Ip ,Port and Topic the configuration will be the following.
```
IP : 172.16.10.10
PORT : 9092
TOPIC : CiscoDDP
```

N.B : System will provide all this configuration automatically.

![Figure](https://github.com/CiscoDevNet/data-dev-learning-labs/blob/master/labs/develop-stream-handler-cisco-csa/assets/images/CSA-TaglogSimulator.png?raw=true)

#### (ii) Trucq configuration will be the following.
```
Memory(MB) : 1024     // We suggest to give minimum 512 MB menory size for CSA Engine.
Countainer Port : 5432  TCP   // Please add a container port to access the CSA Engine by SQL Commands.
Tips : 5432 is default working port of Trucq CSA Engine.
```
</br>
![Figure](https://github.com/CiscoDevNet/data-dev-learning-labs/blob/master/labs/develop-stream-handler-cisco-csa/assets/images/CSA_3.png?raw=true)

<b>Step 6:</b> Now we need to start both of this micro service..<br> Click on the <b>Stack Library</b>
![Figure](https://github.com/prakdutt/data-dev-learning-labs/blob/master/labs/develop-stream-handler-cisco-csa/assets/images/StartService.PNG?raw=true)

Click on the Green arrow button for starting both the micro services.

![Figure](https://github.com/CiscoDevNet/data-dev-learning-labs/blob/master/labs/develop-stream-handler-cisco-csa/assets/images/runMicroservices.png?raw=true)

Running state of two micro services:
![Figure](https://github.com/CiscoDevNet/data-dev-learning-labs/blob/master/labs/develop-stream-handler-cisco-csa/assets/images/CSA_6.png?raw=true)

<b>Step 7:</b> After running Trucq, we will get IP and port. The First IP and port for SQL query to CSA Engine those will vary in every startup.</br>
For example:</br>

```
     10.10.10.92:11841	    // 11841 is the SQL query Listener Port
```
N.B : This IP and Port will be required in <b>Step 12 and Step 17</b>
</br>
**Configuration of customized CSA Handler is described in Section B.**
